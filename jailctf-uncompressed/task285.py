def p(s):
 r=set()
 def p(d,o):
  for (d,o)in (((d,o)in r)==0<((s*2)[d]*2)[o])*((d,o),(d,2*n-1-o),(2*e-1-d,o),(2*e-1-d,2*n-1-o)):s[d][o]=s[e-(d<e)][n-(o<n)];r.add((d,o));[p(d+e,o+n)for e in range(-1,2)for n in range(-1,2)]
 for e in range(len(s)):
  for n in range(len(s[e])):3<len(set(s[e][n-1:n+1]+s[e-1][n-1:n+1]))!=p(e,n)!=p(e,n-1)
 return s