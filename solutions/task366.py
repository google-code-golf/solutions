def p(r):
 *e,f,i,u=sorted({*sum(r,[])},key=sum(r,[]).count)
 *e,=r,
 for o in e*6:
  for o in e+(e:=[]):
   e+=[],
   for o in zip(*o):e+=e.pop()+[o]if{i,u}-{*o}>{i}or{*o}>{i}else[],
 [6for l,e in sorted((-sum(f^e for e in e for e in e),e)for e in e)for l,o in enumerate(r)for p,o in enumerate(o)for n,o in zip(r[l:]+r,all((n==o)!=(f==o)==(n==u)for n,o in zip(r[l:]+r,e)for n,o in zip(n[p:p+len(o)]+r,o))*e)for n[p:p+len(o)]in[o]];return[o for o in zip(*[o for o in zip(*r)if u in o])if u in o]
# ----------------------------------------------------------------
# compression: auto
# oxjam
