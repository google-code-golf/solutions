def p(u):n,e,f=sorted(set(h:=sum(u,[])),key=h.count)[-3:];r,u=[[r[:len(u[0])//2]for r in u],u[:len(u)//2],[r[len(u[0])//2:]for r in u],u[len(u)//2:]][len(u)>len(u[0])::2][::2*(e not in u[0][:8])-1];[e not in(h:=sum(c:=[r[a:a+d]for r in u[s:s+t]],[]))and o==t*d-h.count(n)and[exec('for r in u[s:s+t]:r[a:a+d]=[e]*d')or[all(r[o+e][a:a+d]==[(r,f)[r==n]for r in c[e]]for e in range(t))and exec('for e in range(t):r[o+e][a:a+d]=c[e]')for o in range(len(u)-t+1)for a in range(len(u[0])-d+1)]]for o in range(3,0,-1)for s in range(len(u))for a in range(len(u[0]))for t in range(len(u)-s,0,-1)for d in range(len(u[0])-a,0,-1)];return r